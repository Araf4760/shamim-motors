<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sell Form</title>
  <style>
    body { background-color: #1c1c44; font-family: 'Siyam Rupali', sans-serif; color: white; margin:0; padding:0; }
    .container { max-width:900px; margin:auto; padding:20px; border-radius:20px; box-shadow:0 0 15px rgba(0,0,0,0.5); }
    h2 { font-size:32px; text-align:center; margin-bottom:10px; }
    .header-row{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:10px;}
    .logo-box{width:70px;height:70px;border:2px solid orange;text-align:center;line-height:70px;color:orange;margin-bottom:10px;}
    .form-title{background-color:darkgreen;color:gold;padding:5px 25px;border-radius:6px;font-size:22px;margin-bottom:10px;}
    .search-box{display:flex;align-items:center;gap:8px;}
    .search-box input{flex:1;min-width:120px;padding:5px;border-radius:5px;border:none;}
    .search-label{background:gold;color:darkred;padding:5px 10px;border-radius:4px;font-weight:bold;cursor:pointer;}
    .form-row{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:10px;}
    .form-group{flex:1 1 100%;}
    label{display:block;background-color:#1c1c44;color:gold;padding:5px 10px;border-radius:6px;font-size:14px;margin-bottom:5px;}
    input, textarea, select{width:100%;padding:8px;background-color:#d5d8ff;color:#000033;font-weight:bold;border-radius:5px;border:none;box-sizing:border-box;}
    input[readonly] { background-color: #ccc; color: #333; }
    .section-title{text-align:center;font-size:20px;margin:20px 0 10px;font-weight:bold;}
    .buttons{display:flex;flex-wrap:wrap;justify-content:center;gap:10px;margin-top:20px;}
    .buttons button{background-color:#22225c;color:gold;font-weight:bold;padding:10px 20px;border:none;border-radius:8px;cursor:pointer;}
    .buttons button:hover{background-color:#3a3a85;}
    @media (min-width:601px){ .form-group{flex:1 1 calc(50% - 10px);} }
    @media (max-width:600px){ .search-box{width:100%;margin-top:10px;} }
  </style>
</head>
<body>
  <div class="container">
    <div class="header-row">
      <div class="logo-box">লোগো</div>
      <h2>মেসার্স শামীম মটরস</h2>
      <div class="search-box">
        <div class="form-title">Sell Form</div>
        <div class="search-label" onclick="searchEntry()">সার্চ</div>
        <input type="text" id="searchInput" placeholder="খুঁজুন...">
      </div>
    </div>

    <form id="entryForm">
      <div class="form-row">
        <div class="form-group"><label>ক্রমিক নং:</label><input type="text" name="serial" readonly></div>
        <div class="form-group"><label>তারিখ:</label><input type="date" name="date"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>নাম:</label><input type="text" name="name"></div>
        <div class="form-group"><label>পিতার নাম:</label><input type="text" name="father"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>জাতীয় পরিচয়পত্র:</label><input type="text" name="nid"></div>
        <div class="form-group"><label>জন্মতারিখ:</label><input type="date" name="dob"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>মোবাইল:</label><input type="tel" name="mobile"></div>
        <div class="form-group"><label>ঠিকানা:</label><textarea name="address"></textarea></div>
      </div>
      <div class="section-title">গাড়ির তথ্য</div>
      <div class="form-row">
        <div class="form-group"><label>গাড়ির ধরন:</label><input type="text" name="vehicle_type"></div>
        <div class="form-group"><label>নাম্বার প্লেট:</label><input type="text" name="number_plate"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>ইঞ্জিন নং:</label><input type="text" name="engine"></div>
        <div class="form-group"><label>চ্যাসিস নং:</label><input type="text" name="chassis"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>মডেল:</label><input type="text" name="model"></div>
        <div class="form-group"><label>সিসি:</label><input type="text" name="cc"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>রং:</label><input type="text" name="color"></div>
      </div>
      <div class="section-title">ক্যাশ</div>
      <div class="form-row">
        <div class="form-group"><label>মোট টাকা:</label><input type="number" name="total"></div>
        <div class="form-group"><label>নগদ টাকা:</label><input type="number" name="cash"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>বাকি টাকা:</label><input type="number" name="due" readonly></div>
      </div>

      <div class="buttons">
        <button type="submit">জমা</button>
        <button type="button" onclick="deleteForm()">ডিলিট</button>
        <button type="button" onclick="downloadPDF()">PDF</button>
        <button type="button" onclick="printEntry()">প্রিন্ট</button>
        <button type="button" onclick="downloadData()">তথ্য ডাউনলোড</button>
        <button type="button" onclick="uploadData()">তথ্য আপলোড</button>
      </div>
    </form>
  </div>
  
<script>
  const totalInput = document.querySelector('input[name="total"]');
  const cashInput = document.querySelector('input[name="cash"]');
  const dueInput = document.querySelector('input[name="due"]');

  function calculateDue() {
    const total = parseFloat(totalInput.value) || 0;
    const cash = parseFloat(cashInput.value) || 0;
    const due = total - cash;
    dueInput.value = due >= 0 ? due : 0;
  }

  totalInput.addEventListener('input', calculateDue);
  cashInput.addEventListener('input', calculateDue);
</script>

<!-- sell.html এর শেষে যোগ করুন -->
<script>
  // LocalStorage-এ এন্ট্রিগুলো সংরক্ষণ করার জন্য
  let entries = JSON.parse(localStorage.getItem('sellEntries') || '[]');

  // DOM এলিমেন্টস
  const serialInput = document.querySelector('input[name="serial"]');
  const form = document.getElementById('entryForm');
  const entriesTableContainer = document.createElement('div');
  entriesTableContainer.id = 'entriesTable';
  document.querySelector('.container').appendChild(entriesTableContainer);

  // ১) ক্রমিক স্বয়ংক্রিয় সেট করা
  function updateSerial() {
    serialInput.value = entries.length + 1;
  }

  // ২) এন্ট্রি লিস্ট টেবিল-এ রেন্ডার করা
  function renderEntries() {
    let html = `
      <table border="1" width="100%" style="margin-top:20px;background:#fff;color:#000;">
        <thead>
          <tr>
            <th>ক্রমিক নং</th><th>তারিখ</th><th>নাম</th><th>গাড়ির ধরন</th>
            <th>নাম্বার প্লেট</th><th>ইঞ্জিন নং</th><th>চ্যাসিস নং</th><th>মোট টাকা</th>
            <th>নগদ টাকা</th><th>বাকি টাকা</th>
          </tr>
        </thead><tbody>
    `;
    entries.forEach(e => {
      html += `
        <tr>
          <td>${e.serial}</td><td>${e.date}</td><td>${e.name}</td>
          <td>${e.vehicle_type}</td><td>${e.number_plate}</td>
          <td>${e.engine}</td><td>${e.chassis}</td>
          <td>${e.total}</td><td>${e.cash}</td><td>${e.due}</td>
        </tr>
      `;
    });
    html += `</tbody></table>`;
    entriesTableContainer.innerHTML = html;
  }

  // ৩) জমা (Submit) — ফর্ম থেকে ডাটা নিয়ে LocalStorage-এ সেভ
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(form).entries());
    data.serial = entries.length + 1;
    entries.push(data);
    localStorage.setItem('sellEntries', JSON.stringify(entries));
    updateSerial();
    renderEntries();
    form.reset();
  });

  // ৪) সার্চ
  function searchEntry() {
    const q = document.getElementById('searchInput').value.toLowerCase();
    const rows = entriesTableContainer.querySelectorAll('tbody tr');
    rows.forEach(row => {
      const match = [...row.cells].some(td => td.textContent.toLowerCase().includes(q));
      row.style.display = match ? '' : 'none';
    });
  }

  // ৫) ডিলিট — সর্বশেষ এন্ট্রি রিমুভ
  function deleteForm() {
    if (!entries.length) return alert('কোনো এন্ট্রি নেই।');
    entries.pop();
    localStorage.setItem('sellEntries', JSON.stringify(entries));
    updateSerial();
    renderEntries();
  }

  // ৬) PDF & প্রিন্ট
  function downloadPDF() {
    // print-form.html খুলবে নতুন ট্যাব/উইন্ডোতে
    window.open('print-form.html', '_blank');
  }
  function printEntry() {
    downloadPDF();
  }

  // ৭) তথ্য ডাউনলোড — শুধুমাত্র sell.html-এ জমাকৃত ডাটা
  function downloadData() {
    const blob = new Blob([JSON.stringify(entries, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'sell-data.json';
    a.click();
    URL.revokeObjectURL(url);
  }

  // ৮) তথ্য আপলোড — JSON ফাইল থেকে পুনরায় লোড
  function uploadData() {
    const inp = document.createElement('input');
    inp.type = 'file';
    inp.accept = '.json';
    inp.onchange = e => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = () => {
        try {
          entries = JSON.parse(reader.result);
          localStorage.setItem('sellEntries', JSON.stringify(entries));
          updateSerial();
          renderEntries();
        } catch {
          alert('ভুল ফরম্যাটের ফাইল।');
        }
      };
      reader.readAsText(file);
    };
    inp.click();
  }

  // পেজ লোডে ইনিশিয়াল সেটআপ
  updateSerial();
  renderEntries();
</script>

<script>
  // ৬) PDF & প্রিন্ট (সার্চে পাওয়া তথ্য প্রিন্টে যাবে)
  function downloadPDF() {
    // ফর্মের সব ইনপুট থেকে তথ্য নিয়ে অবজেক্ট বানানো
    const formData = new FormData(document.getElementById('entryForm'));
    const entry = {};
    for (const [key, value] of formData.entries()) {
      entry[key] = value;
    }

    // সব ফিল্ড খালি হলে বোঝা যাবে কিছুই খোঁজা হয়নি
    const allEmpty = Object.values(entry).every(v => !v.trim());
    if (allEmpty) {
      return alert('প্রিন্ট করার জন্য কোনো তথ্য পাওয়া যায়নি। অনুগ্রহ করে সার্চ করুন।');
    }

    const dataStr = encodeURIComponent(JSON.stringify(entry));
    const url = 'print-form.html?data=' + dataStr;
    window.open(url, '_blank');
  }

  function printEntry() {
    downloadPDF();
  }
</script>


<script>
  // ৪) সার্চ — ফর্মে মিলানো এন্ট্রির সম্পূর্ণ তথ্য লোড করবে
  function searchEntry() {
    const q = document.getElementById('searchInput').value.toLowerCase().trim();
    // entries অ্যারে থেকে প্রথম মেলা এন্ট্রি খুঁজে নিন
    const entry = entries.find(e =>
      Object.values(e).some(val =>
        val.toString().toLowerCase().includes(q)
      )
    );
    if (entry) {
      // প্রতিটি ফর্ম ইনপুটে মান বসিয়ে দিন
      Object.entries(entry).forEach(([key, value]) => {
        const field = form.querySelector(`[name="${key}"]`);
        if (field) field.value = value;
      });
      // বাকি টাকা আপডেট করার জন্য
      if (typeof calculateDue === 'function') calculateDue();
    } else {
      alert('কোনো মেলা এন্ট্রি পাওয়া যায়নি।');
    }
  }
</script>
  
</body>
</html>
