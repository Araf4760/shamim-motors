<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sell Form</title>
  <style>
    body { background-color: #1c1c44; font-family: 'Siyam Rupali', sans-serif; color: white; margin:0; padding:0; }
    .container { max-width:900px; margin:auto; padding:20px; border-radius:20px; box-shadow:0 0 15px rgba(0,0,0,0.5); }
    h2 { font-size:32px; text-align:center; margin-bottom:10px; }
    .header-row{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:10px;}
    .logo-box{width:70px;height:70px;border:2px solid orange;text-align:center;line-height:70px;color:orange;margin-bottom:10px;}
    .form-title{background-color:darkgreen;color:gold;padding:5px 25px;border-radius:6px;font-size:22px;margin-bottom:10px;}
    .search-box{display:flex;align-items:center;gap:8px;}
    .search-box input{flex:1;min-width:120px;padding:5px;border-radius:5px;border:none;}
    .search-label{background:gold;color:darkred;padding:5px 10px;border-radius:4px;font-weight:bold;cursor:pointer;}
    .form-row{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:10px;}
    .form-group{flex:1 1 100%;}
    label{display:block;background-color:#1c1c44;color:gold;padding:5px 10px;border-radius:6px;font-size:14px;margin-bottom:5px;}
    input, textarea, select{width:100%;padding:8px;background-color:#d5d8ff;color:#000033;font-weight:bold;border-radius:5px;border:none;box-sizing:border-box;}
    .section-title{text-align:center;font-size:20px;margin:20px 0 10px;font-weight:bold;}
    .buttons{display:flex;flex-wrap:wrap;justify-content:center;gap:10px;margin-top:20px;}
    .buttons button{background-color:#22225c;color:gold;font-weight:bold;padding:10px 20px;border:none;border-radius:8px;cursor:pointer;}
    .buttons button:hover{background-color:#3a3a85;}
    @media (min-width:601px){ .form-group{flex:1 1 calc(50% - 10px);} }
    @media (max-width:600px){ .search-box{width:100%;margin-top:10px;} }
  </style>
</head>
<body>
  <div class="container">
    <div class="header-row">
      <div class="logo-box">লোগো</div>
      <h2>মেসার্স শামীম মটরস</h2>
      <div class="search-box">
        <div class="form-title">Sell Form</div>
        <div class="search-label" onclick="searchEntry()">সার্চ</div>
        <input type="text" id="searchInput" placeholder="খুঁজুন...">
      </div>
    </div>

    <form id="entryForm">
      <div class="form-row">
        <div class="form-group"><label>ক্রমিক নং:</label><input type="text" name="serial"></div>
        <div class="form-group"><label>তারিখ:</label><input type="date" name="date"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>নাম:</label><input type="text" name="name"></div>
        <div class="form-group"><label>পিতা/স্বামীর নাম:</label><input type="text" name="father"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>জাতীয় পরিচয়পত্র:</label><input type="text" name="nid"></div>
        <div class="form-group"><label>জন্মতারিখ:</label><input type="date" name="dob"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>মোবাইল:</label><input type="tel" name="mobile"></div>
        <div class="form-group"><label>ঠিকানা:</label><textarea name="address"></textarea></div>
      </div>
      <div class="section-title">গাড়ির তথ্য</div>
      <div class="form-row">
        <div class="form-group"><label>গাড়ির ধরন:</label><input type="text" name="vehicle_type"></div>
        <div class="form-group"><label>নাম্বার প্লেট:</label><input type="text" name="number_plate"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>ইঞ্জিন নং:</label><input type="text" name="engine"></div>
        <div class="form-group"><label>চ্যাসিস নং:</label><input type="text" name="chassis"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>মডেল:</label><input type="text" name="model"></div>
        <div class="form-group"><label>সিসি:</label><input type="text" name="cc"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>রং:</label><input type="text" name="color"></div>
      </div>
      <div class="section-title">ক্যাশ</div>
      <div class="form-row">
        <div class="form-group"><label>মোট টাকা:</label><input type="number" name="total"></div>
        <div class="form-group"><label>নগদ টাকা:</label><input type="number" name="cash"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>বাকি টাকা:</label><input type="number" name="due" readonly></div>
      </div>

      <div class="buttons">
        <button type="submit">জমা</button>
        <button type="button" onclick="loadPrevious()">পূর্বের তথ্য</button>
        <button type="button" onclick="loadNext()">পরের তথ্য</button>
        <button type="button" onclick="deleteEntry()">ডিলিট</button>
        <button type="button" onclick="downloadPDF()">PDF</button>
        <button type="button" onclick="printEntry()">প্রিন্ট</button>
        <button type="button" onclick="exportData()">এক্সপোর্ট</button>
      </div>
    </form>
  </div>

  <script>
    const URL = 'https://script.google.com/macros/s/AKfycbzrGTdYasgFCS6h5P5-FYteTMm4stfGFP4RtSPp7ge-s5ObDro3Z7fAixHh5AC0zH6a/exec';
    let entries = [], currentIndex = -1;

    // সব এন্ট্রি নিয়ে আসে
    async function fetchEntries() {
      const resp = await fetch(URL);
      entries = await resp.json();
    }
    fetchEntries();

    // ফর্ম ডাটা রিড
    function getFormData() {
      const form = document.getElementById('entryForm');
      const fd = new FormData(form), obj = {};
      fd.forEach((v, k) => obj[k] = v);
      return obj;
    }

    // জমা: POST
    document.getElementById('entryForm').addEventListener('submit', async e => {
      e.preventDefault();
      const data = getFormData();
      const formData = new FormData();
      Object.entries(data).forEach(([k, v]) => formData.append(k, v));
      await fetch(URL, { method: 'POST', body: formData });
      alert('তথ্য সফলভাবে জমা হয়েছে ✅');
      e.target.reset();
      await fetchEntries();
    });

    // ফর্মে প্রদর্শন
    function fillForm(obj) {
      const form = document.getElementById('entryForm');
      Object.keys(obj).forEach(k => {
        if (form.elements[k]) form.elements[k].value = obj[k];
      });
    }

    // নেভিগেশন
    function loadPrevious() {
      if (!entries.length) return alert('কোন তথ্য নাই!');
      currentIndex = currentIndex <= 0 ? entries.length - 1 : currentIndex - 1;
      fillForm(entries[currentIndex]);
    }
    function loadNext() {
      if (!entries.length) return alert('কোন তথ্য নাই!');
      currentIndex = (currentIndex + 1) % entries.length;
      fillForm(entries[currentIndex]);
    }

    // ডিলিট
    async function deleteEntry() {
      if (currentIndex < 0) return alert('ডিলেটের জন্য লোড করুন!');
      if (!confirm('আপনি কি নিশ্চিত?')) return;
      await fetch(`${URL}?action=delete&id=${currentIndex}`);
      alert('ডিলিট সম্পন্ন ✅');
      await fetchEntries();
      currentIndex = -1;
      document.getElementById('entryForm').reset();
    }

    // সার্চ
    function searchEntry() {
      const q = document.getElementById('searchInput').value.trim().toLowerCase();
      const idx = entries.findIndex(ent => Object.values(ent).some(v => String(v).toLowerCase().includes(q)));
      if (idx >= 0) {
        currentIndex = idx;
        fillForm(entries[idx]);
        alert('তথ্য পাওয়া গেছে ✅');
      } else alert('তথ্য পাওয়া যায়নি ❌');
    }

    // এক্সপোর্ট
    function exportData() {
      const blob = new Blob([JSON.stringify(entries, null, 2)], { type: 'application/json' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'entries.json';
      link.click();
    }

    // হিসাব: বাকি টাকা
    const totalInput = document.querySelector('input[name="total"]');
    const cashInput  = document.querySelector('input[name="cash"]');
    const dueInput   = document.querySelector('input[name="due"]');
    function calculateDue() {
      const t = parseFloat(totalInput.value) || 0;
      const c = parseFloat(cashInput.value) || 0;
      dueInput.value = Math.max(0, t - c);
    }
    totalInput.addEventListener('input', calculateDue);
    cashInput.addEventListener('input', calculateDue);

    // প্রিন্ট / PDF
    function printEntry() {
      if (currentIndex < 0) return alert('প্রিন্টের জন্য লোড করুন!');
      const data = entries[currentIndex];
      const w = window.open('', '_blank');
      let html = `<h2 style="text-align:center;">মেসার্স শামীম মটরস</h2><table style="width:100%;border-collapse:collapse;">`;
      Object.entries(data).forEach(([k, v]) => {
        html += `<tr><th style="border:1px solid #000;padding:5px;">${k}</th><td style="border:1px solid #000;padding:5px;">${v}</td></tr>`;
      });
      html += `</table>`;
      w.document.write(html);
      w.document.close();
      w.focus();
      w.print();
    }
    function downloadPDF() { printEntry(); }
  </script>
</body>
</html>
