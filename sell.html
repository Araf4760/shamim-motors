<!-- entry.html (With Print Button + Search Functionality) -->
<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>Entry Form</title>
  <style>
    body {
      background-color: #1c1c44;
      font-family: 'Siyam Rupali', sans-serif;
      color: white;
      padding: 30px;
    }
    .container {
      background-color: #1c1c44;
      max-width: 900px;
      margin: auto;
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 0 15px rgba(0,0,0,0.5);
    }
    h2 {
      font-size: 32px;
      text-align: center;
      margin-bottom: 10px;
    }
    .header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .logo-box {
      width: 70px;
      height: 70px;
      border: 2px solid orange;
      margin-right: 10px;
      text-align: center;
      line-height: 70px;
    }
    .form-title {
      background-color: darkgreen;
      color: gold;
      padding: 5px 25px;
      border-radius: 6px;
      font-size: 22px;
    }
    .search-box {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .search-box input {
      width: 100px;
      padding: 5px;
      border-radius: 5px;
      border: none;
    }
    .search-label {
      background: gold;
      color: darkred;
      padding: 5px 10px;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
    }
    .form-row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    .form-group {
      flex: 1;
    }
    label {
      display: block;
      background-color: #1c1c44;
      color: gold;
      padding: 5px 10px;
      border-radius: 6px;
      font-size: 14px;
      margin-bottom: 5px;
    }
    input {
      width: 100%;
      padding: 8px;
      background-color: #d5d8ff;
      color: #000033;
      font-weight: bold;
      border-radius: 5px;
      border: none;
    }
    .section-title {
      text-align: center;
      font-size: 20px;
      margin: 20px 0 10px;
      font-weight: bold;
    }
    .buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }
    .buttons button {
      background-color: #22225c;
      color: gold;
      font-weight: bold;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .buttons button:hover {
      background-color: #3a3a85;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header-row">
      <div class="logo-box">লোগো</div>
      <h2>মেসার্স শামীম মটরস</h2>
      <div class="search-box">
        <div class="form-title">Entry Form</div>
        <div class="search-label" onclick="searchEntry()">সার্চ</div>
        <input type="text" id="searchInput">
      </div>
    </div>

    <form id="entryForm">
      <!-- form rows (same as before) -->
      <div class="form-row">
        <div class="form-group">
          <label>ক্রমিক নং:</label>
          <input type="text" name="serial">
        </div>
        <div class="form-group">
          <label>তারিখ:</label>
          <input type="date" name="date">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>নাম:</label>
          <input type="text" name="name">
        </div>
        <div class="form-group">
          <label>পিতার নাম:</label>
          <input type="text" name="father">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>এন.আই.ডি নং:</label>
          <input type="text" name="nid">
        </div>
        <div class="form-group">
          <label>জন্ম তারিখ:</label>
          <input type="date" name="dob">
        </div>
        <div class="form-group">
          <label>মোবাইল নম্বর:</label>
          <input type="text" name="mobile">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>ঠিকানা:</label>
          <input type="text" name="address">
        </div>
      </div>
      <div class="section-title">বিবরণ</div>
      <div class="form-row">
        <div class="form-group">
          <label>গাড়ির ধরন:</label>
          <input type="text" name="vehicle_type">
        </div>
        <div class="form-group">
          <label>ইঞ্জিন নম্বর:</label>
          <input type="text" name="engine">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>চেসিস নম্বর:</label>
          <input type="text" name="chassis">
        </div>
        <div class="form-group">
          <label>মডেল:</label>
          <input type="text" name="model">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>সিসি:</label>
          <input type="text" name="cc">
        </div>
        <div class="form-group">
          <label>কালার:</label>
          <input type="text" name="color">
        </div>
      </div>
      <div class="section-title">ব্যয়সম</div>
      <div class="form-row">
        <div class="form-group">
          <label>মোট টাকা:</label>
          <input type="text" name="total">
        </div>
        <div class="form-group">
          <label>নগদ টাকা:</label>
          <input type="text" name="cash">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>বাকি টাকা:</label>
          <input type="text" name="due">
        </div>
      </div>
      <div class="buttons">
        <button type="submit">জমা</button>
        <button type="button" onclick="loadPrevious()">পূর্বের তথ্য</button>
        <button type="button" onclick="loadNext()">পরের তথ্য</button>
        <button type="button" onclick="deleteForm()">ডিলিট</button>
        <button type="button" onclick="print()">প্রিন্ট</button>
        <button type="button" onclick="downloadPDF()">PDF</button>
        <button type="button" onclick="exportData()">এক্সপোর্ট</button>
      </div>
    </form>
  </div>

  <script>
    let currentIndex = 0;

    function getFormData() {
      const form = document.getElementById("entryForm");
      const data = new FormData(form);
      const obj = {};
      data.forEach((val, key) => obj[key] = val);
      return obj;
    }

    function saveToLocal(data) {
      let entries = JSON.parse(localStorage.getItem("entries") || "[]");
      entries.push(data);
      localStorage.setItem("entries", JSON.stringify(entries));
    }

    document.getElementById("entryForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const data = getFormData();
      saveToLocal(data);
      alert("তথ্য জমা হয়েছে ✅");
      this.reset();
    });

    function loadForm(index) {
      const entries = JSON.parse(localStorage.getItem("entries") || "[]");
      if (entries.length === 0) {
        alert("কোন তথ্য পাওয়া যায়নি!");
        return;
      }
      if (index < 0 || index >= entries.length) {
        alert("আর কোনো তথ্য নেই!");
        return;
      }
      currentIndex = index;
      const form = document.getElementById("entryForm");
      const data = entries[index];
      Object.keys(data).forEach((key) => {
        if (form.elements[key]) {
          form.elements[key].value = data[key];
        }
      });
    }

    function loadPrevious() {
      if (currentIndex > 0) {
        loadForm(currentIndex - 1);
      } else {
        alert("এইটা প্রথম তথ্য!");
      }
    }

    function loadNext() {
      const entries = JSON.parse(localStorage.getItem("entries") || "[]");
      if (currentIndex < entries.length - 1) {
        loadForm(currentIndex + 1);
      } else {
        alert("এইটা শেষ তথ্য!");
      }
    }

    function deleteForm() {
      let entries = JSON.parse(localStorage.getItem("entries") || "[]");
      if (entries.length === 0) {
        alert("মুছতে কিছু নেই!");
        return;
      }
      if (!confirm("আপনি কি এই তথ্য মুছে ফেলতে চান?")) return;
      entries.splice(currentIndex, 1);
      localStorage.setItem("entries", JSON.stringify(entries));
      if (entries.length > 0) {
        currentIndex = Math.min(currentIndex, entries.length - 1);
        loadForm(currentIndex);
      } else {
        document.getElementById("entryForm").reset();
        alert("সব তথ্য মুছে ফেলা হয়েছে।");
      }
    }

    function exportData() {
      const entries = JSON.parse(localStorage.getItem("entries") || "[]");
      const blob = new Blob([JSON.stringify(entries, null, 2)], {type: "application/json"});
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "entries.json";
      link.click();
    }

    function searchEntry() {
      const query = document.getElementById("searchInput").value.trim().toLowerCase();
      const entries = JSON.parse(localStorage.getItem("entries") || "[]");
      const foundIndex = entries.findIndex(entry => {
        return Object.values(entry).some(val => val.toLowerCase().includes(query));
      });
      if (foundIndex >= 0) {
        loadForm(foundIndex);
        alert("তথ্য পাওয়া গেছে ✅");
      } else {
        alert("তথ্য পাওয়া যায়নি ❌");
      }
    }
  </script>
  <script>
  function print() {
  const entries = JSON.parse(localStorage.getItem("entries") || "[]");
  if (entries.length === 0) {
    alert("প্রিন্ট করার মতো তথ্য পাওয়া যায়নি!");
    return;
  }
  const selectedEntry = entries[currentIndex]; // ✅ এখনকার এন্ট্রি
  const query = encodeURIComponent(JSON.stringify(selectedEntry));
  window.open("print-form.html?data=" + query, "_blank");
}
</script>
<script>
  function downloadPDF() {
    const entries = JSON.parse(localStorage.getItem("entries") || "[]");
    if (entries.length === 0) {
      alert("PDF করার মতো তথ্য নেই!");
      return;
    }
    const selectedEntry = entries[currentIndex];
    const query = encodeURIComponent(JSON.stringify(selectedEntry));
    const printWindow = window.open("print-form.html?data=" + query, "_blank");

    // Wait for new window to load then trigger print (PDF save)
    printWindow.onload = function () {
      printWindow.focus();
      printWindow.print();
    };
  }
</script>
  <script>
  const scriptURL = 'https://script.google.com/macros/s/AKfycbya0qqZXpmIMgLStBB16-xcgkVyNv3RbeT3Xyq2pC3myJO2PD5AsYYDt3sE8WkQvl4dwA/exec';
  const form = document.getElementById('entryForm');

  form.addEventListener('submit', e => {
    e.preventDefault();
    fetch(scriptURL, { method: 'POST', body: new FormData(form)})
      .then(response => {
        alert('✅ ফর্মের তথ্য সফলভাবে Google Sheets-এ পাঠানো হয়েছে!');
        form.reset();
      })
      .catch(error => {
        alert('❌ কিছু একটা সমস্যা হয়েছে!');
        console.error('Error!', error.message);
      });
  });
</script>
</body>
</html>
